\documentclass[uplatex,a4paper,10pt]{jsarticle}
\usepackage[dvipdfmx]{graphicx}
\usepackage{geometry}
\geometry{margin=20mm}
\usepackage{titlesec}
\usepackage{array}
\usepackage{enumitem}
\usepackage{hyperref}
\hypersetup{colorlinks=true,linkcolor=black,urlcolor=black}

% ========== biblatex 設定 ==========
\usepackage[
  backend=biber,     % biber を使用
  bibencoding=utf8,
  sorting=ydnt,      % year-desc, name, title
  maxbibnames=99,
  giveninits=true,
  defernumbers=true, % セクションごとに番号を持たせない
  isbn=false, doi=false, url=false, eprint=false
]{biblatex}

% サイト共通の ref.bib を参照（main.tex からの相対パス）
\addbibresource{../ref.bib}

% ---- カスタム型とフィールド（award / grant）を定義 ----
\DeclareDatamodelEntrytypes{award,grant}
\DeclareDatamodelFields[type=field,datatype=literal]{event,amount}
\DeclareDatamodelEntryfields[award]{event,organization}
\DeclareDatamodelEntryfields[grant]{organization,amount}

% ---- 表示ドライバ（出力体裁）----
\DeclareNameAlias{default}{family-given}

\DeclareBibliographyDriver{award}{%
  \printnames{author}%
  \newunit
  \printfield{title}%
  \newunit
  \printlist{organization}%
  \newunit
  \printfield{event}%
  \newunit
  \printfield{year}%
  \newunit
  \printfield{note}%
  \finentry
}

\DeclareBibliographyDriver{grant}{%
  \printnames{author}%
  \newunit
  \printfield{title}%
  \newunit
  \printlist{organization}%
  \newunit
  \printfield{year}%
  \newunit
  \printfield{amount}%
  \newunit
  \printfield{note}%
  \finentry
}

% ---- フィルタ（keywords / type で振り分け）----
\defbibfilter{journals}{ type=article }
\defbibfilter{conf-intl}{ keyword={conference-international} }
\defbibfilter{conf-dom }{ keyword={conference-domestic} }
\defbibfilter{awards   }{ type=award or keyword={awards} }
\defbibfilter{grants   }{ type=grant or keyword={grants} }

% ========== CV レイアウトの軽い整形 ==========
\titleformat{\section}{\large\bfseries}{\thesection}{1em}{}
\titlespacing{\section}{0pt}{8pt}{4pt}
\setlist[itemize]{leftmargin=*, itemsep=2pt, topsep=2pt}
\setlength{\parskip}{2pt}
\setlength{\parindent}{0pt}

\newcommand{\cvitem}[3]{%
  \begin{tabular*}{\textwidth}{@{}p{0.72\textwidth}@{\extracolsep{\fill}}p{0.25\textwidth}@{}}
    \textbf{#1} & \raggedleft #2 \\
  \end{tabular*}\\[-2pt]
  #3\par\vspace{4pt}
}

\newcommand{\cvheader}[3]{%
  {\LARGE \textbf{#1}}\\[4pt]
  #2\\
  #3
}

\begin{document}

% ==== ヘッダー ====
\cvheader{Takahiro Matsunaga}
{Department of Civil Engineering, the University of Tokyo}
{7-3-1 Hongo, Bunkyo-ku, Tokyo 113-8656, Japan} \\
% {(+81) xx-xxxx-xxxx \ \ $\diamond$ \ \ \href{mailto:matsunaga@bin.t.u-tokyo.ac.jp}{matsunaga@bin.t.u-tokyo.ac.jp} \ \ $\diamond$ \ \ \href{https://scholar.google.com/citations?user=fGWoyocAAAAJ}{Google Scholar}}
{\href{mailto:matsunaga@bin.t.u-tokyo.ac.jp}{matsunaga@bin.t.u-tokyo.ac.jp}}
\vspace{8pt}

% ==== EXPERIENCE（手書きセクションは自由記述）====
\section*{EXPERIENCE}
% \cvitem{Research Assistant, The University of Tokyo}{2025.04--Present}
% {Behavior in Networks (BinN) Studies Unit. Advisor: Prof. Eiji Hato.}

% ==== EDUCATION ====
\section*{EDUCATION}
\cvitem{The University of Tokyo}{2020--}
{Ph.D. in Civil Engineering.}{since 2025.10}
{M.S. in Civil Engineering (Outstanding Paper Award).}{2024.04 - 2025.09}
{B.S. in Civil Engineering (Best Paper Award).}{2020.04 - 2024.03}

% ==== PUBLICATIONS ====
\section*{PUBLICATIONS (Peer-Reviewed Journals)}
\printbibliography[filter=journal_papers, heading=none]

\section*{CONFERENCE PAPERS (International)}
\printbibliography[filter=conf-intl, heading=none]

\section*{CONFERENCE PAPERS (Domestic)}
\printbibliography[filter=conf-dom, heading=none]

% ==== HONORS & AWARDS ====
\section*{HONORS \& AWARDS}
\printbibliography[filter=awards, heading=none]

% ==== GRANTS ====
\section*{GRANTS}
\printbibliography[filter=grants, heading=none]

\end{document}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=journal-int,
%   title={Peer-Reviewed International Journal Papers}
% ]
% \end{refsection}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=journal-int-ur,
%   title={Peer-Reviewed International Journal Papers (Under Review)}
% ]
% \end{refsection}


% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=journal-dom,
%   title={Peer-Reviewed National Journal Papers (in Japanese)}
% ]
% \end{refsection}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=conf-intl,
%   title={Peer-Reviewed International Conferences}
% ]
% \end{refsection}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=conf-dom,
%   title={Peer-Reviewed National Conferences (in Japanese)}
% ]
% \end{refsection}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=pre-dom,
%   title={Oral Presentation without Review (in Japanese)}
% ]
% \end{refsection}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=grant,
%   title={Grants}
% ]
% \end{refsection}

% \begin{refsection}
% \nocite{*}
% \printbibliography[
%   filter=award,
%   title={Awards}
% ]
% \end{refsection}
